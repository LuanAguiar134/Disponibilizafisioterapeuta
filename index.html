<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>DisponibilizaFisio</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; margin:0; padding:0; }
    header { text-align:center; background: #4a90e2; color:white; padding:20px; }
    header img { width:160px; display:block; margin:0 auto 10px; }
    .container { max-width:500px; background:#fff; margin:20px auto; padding:20px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.2); }
    label { display:block; margin:10px 0 5px; }
    input, select, button { width:100%; padding:10px; margin-bottom:15px; border:1px solid #ccc; border-radius:5px; }
    button { background:#6a0dad; color:white; border:none; cursor:pointer; }
    button:hover { background:#4a90e2; }
    .hidden { display:none; }
    .solicitacao { background:#e0e0e0; padding:10px; border-radius:5px; margin:5px 0; }
    #msgLogout { color: green; margin-bottom: 10px; font-weight: bold; text-align: center; }
  </style>
</head>
<body>
  <header>
    <img src="https://i.imgur.com/pogIrpm.jpeg" alt="Logo" />
    <h1>DisponibilizaFisio</h1>
    <p>Seu bem estar mais próximo de você!</p>
  </header>

  <!-- Área de cadastro/login -->
  <div class="container hidden" id="auth">
    <div id="msgLogout" class="hidden"></div>
    <h2>Cadastro</h2>
    <label>Tipo de Usuário</label>
    <select id="tipo">
      <option value="paciente">Paciente</option>
      <option value="fisioterapeuta">Fisioterapeuta</option>
    </select>
    <label>Nome</label>
    <input type="text" id="nome" />
    <label>Telefone</label>
    <input type="text" id="telefone" />
    <label>Email</label>
    <input type="email" id="email" />
    <label>Senha</label>
    <input type="password" id="senha" />
    <label>Confirmar Senha</label>
    <input type="password" id="confirmarSenha" />
    <div id="areaFisio" class="hidden">
      <label>Área de Atuação</label>
      <select id="especialidade">
        <option>Acupuntura</option>
        <option>Aquática</option>
        <option>Cardiovascular</option>
        <option>Dermatofuncional</option>
        <option>Desportiva</option>
        <option>Do Trabalho</option>
        <option>Gerontologia</option>
        <option>Neurofuncional</option>
        <option>Oncologia</option>
        <option>Reumatologia</option>
        <option>Respiratória</option>
        <option>Traumato-Ortopédica</option>
        <option>Saúde da Mulher</option>
        <option>Terapia Intensiva</option>
        <option>Osteopatia</option>
        <option>Quiropraxia</option>
      </select>
    </div>
    <button onclick="cadastrar()">Cadastrar</button>

    <h2>Login</h2>
    <label>Email</label>
    <input type="email" id="loginEmail" />
    <label>Senha</label>
    <input type="password" id="loginSenha" />
    <button onclick="login()">Entrar</button>
  </div>

  <!-- Painel do Fisioterapeuta -->
  <div class="container hidden" id="painelFisio">
    <h2>Painel do Fisioterapeuta</h2>
    <p>Seus dados foram salvos e pacientes poderão te encontrar pelo filtro.</p>
    <h3>Solicitações de Atendimento</h3>
    <div id="solicitacoes"></div>
    <button onclick="logout()">Sair</button>
  </div>

  <!-- Painel do Paciente -->
  <div class="container hidden" id="painelPaciente">
    <h2>Buscar Fisioterapeutas</h2>
    <label>Selecione a área de fisioterapia</label>
    <select id="filtroArea"></select>
    <button onclick="buscarFisioterapeutas()">Buscar</button>
    <div id="listaFisio"></div>
    <button onclick="logout()">Sair</button>
  </div>

  <script>
    let usuarios = JSON.parse(localStorage.getItem("usuarios") || "[]");
    let solicitacoes = JSON.parse(localStorage.getItem("solicitacoes") || "[]");
    let usuarioLogado = JSON.parse(localStorage.getItem("usuarioLogado") || "null");

    const msgLogout = document.getElementById("msgLogout");

    document.getElementById("tipo").addEventListener("change", (e) => {
      document.getElementById("areaFisio").classList.toggle("hidden", e.target.value !== "fisioterapeuta");
    });

    function preencherFiltro() {
      const areas = [
        "Acupuntura", "Aquática", "Cardiovascular", "Dermatofuncional",
        "Desportiva", "Do Trabalho", "Gerontologia", "Neurofuncional",
        "Oncologia", "Reumatologia", "Respiratória", "Traumato-Ortopédica",
        "Saúde da Mulher", "Terapia Intensiva", "Osteopatia", "Quiropraxia"
      ];
      const select = document.getElementById("filtroArea");
      select.innerHTML = areas.map((a) => `<option>${a}</option>`).join("");
    }

    preencherFiltro();

    // Mostra painel se já estiver logado
    if (usuarioLogado) {
      mostrarPainel();
    } else {
      document.getElementById("auth").classList.remove("hidden");
    }

    function cadastrar() {
      msgLogout.classList.add("hidden");
      const tipo = document.getElementById("tipo").value;
      const nome = document.getElementById("nome").value.trim();
      const telefone = document.getElementById("telefone").value.trim();
      const email = document.getElementById("email").value.trim();
      const senha = document.getElementById("senha").value.trim();
      const confirmarSenha = document.getElementById("confirmarSenha").value.trim();
      const especialidade = tipo === "fisioterapeuta" ? document.getElementById("especialidade").value : null;

      if (!nome || !telefone || !email || !senha || !confirmarSenha) {
        alert("Preencha todos os campos.");
        return;
      }

      if (senha !== confirmarSenha) {
        alert("As senhas não coincidem.");
        return;
      }

      if (usuarios.find((u) => u.email === email)) {
        alert("Email já cadastrado.");
        return;
      }

      const novoUsuario = { tipo, nome, telefone, email, senha, especialidade };
      usuarios.push(novoUsuario);
      localStorage.setItem("usuarios", JSON.stringify(usuarios));
      alert("Cadastro realizado com sucesso! Faça login.");

      document.getElementById("nome").value = "";
      document.getElementById("telefone").value = "";
      document.getElementById("email").value = "";
      document.getElementById("senha").value = "";
      document.getElementById("confirmarSenha").value = "";
    }

    function login() {
      msgLogout.classList.add("hidden");
      const email = document.getElementById("loginEmail").value.trim();
      const senha = document.getElementById("loginSenha").value.trim();
      const usuario = usuarios.find((u) => u.email === email && u.senha === senha);

      if (!usuario) {
        alert("Email ou senha inválidos.");
        return;
      }

      usuarioLogado = usuario;
      localStorage.setItem("usuarioLogado", JSON.stringify(usuarioLogado));
      mostrarPainel();
    }

    function logout() {
      if (confirm("Tem certeza que deseja sair?")) {
        usuarioLogado = null;
        localStorage.removeItem("usuarioLogado");

        document.getElementById("auth").classList.remove("hidden");
        document.getElementById("painelFisio").classList.add("hidden");
        document.getElementById("painelPaciente").classList.add("hidden");
        document.getElementById("listaFisio").innerHTML = "";
        document.getElementById("solicitacoes").innerHTML = "";
        document.getElementById("loginEmail").value = "";
        document.getElementById("loginSenha").value = "";
        msgLogout.textContent = "Você saiu com sucesso!";
        msgLogout.classList.remove("hidden");

        window.scrollTo(0, 0);
      }
    }

    function mostrarPainel() {
      msgLogout.classList.add("hidden");
      document.getElementById("auth").classList.add("hidden");

      if (usuarioLogado.tipo === "fisioterapeuta") {
        document.getElementById("painelFisio").classList.remove("hidden");
        mostrarSolicitacoes();
      } else {
        document.getElementById("painelPaciente").classList.remove("hidden");
      }
    }

    function buscarFisioterapeutas() {
      const area = document.getElementById("filtroArea").value;
      const lista = document.getElementById("listaFisio");
      lista.innerHTML = "";

      const fisioterapeutas = usuarios.filter(
        (u) => u.tipo === "fisioterapeuta" && u.especialidade === area
      );

      if (fisioterapeutas.length === 0) {
        lista.innerHTML = "<p>Nenhum fisioterapeuta encontrado nesta área.</p>";
      } else {
        fisioterapeutas.forEach((f) => {
          lista.innerHTML += `
            <div class="solicitacao">
              <p><b>${f.nome}</b> - ${f.telefone} [${f.especialidade}]</p>
              <button onclick="solicitarAtendimento('${f.email}')">Solicitar Atendimento</button>
            </div>`;
        });
      }
    }

    function solicitarAtendimento(emailFisio) {
      const jaSolicitou = solicitacoes.find(
        (s) => s.fisioEmail === emailFisio && s.pacienteEmail === usuarioLogado.email
      );

      if (jaSolicitou) {
        alert("Você já solicitou atendimento a este fisioterapeuta.");
        return;
      }

      solicitacoes.push({
        fisioEmail: emailFisio,
        pacienteNome: usuarioLogado.nome,
        pacienteTelefone: usuarioLogado.telefone,
        pacienteEmail: usuarioLogado.email
      });

      localStorage.setItem("solicitacoes", JSON.stringify(solicitacoes));
      alert("Solicitação enviada com sucesso!");
    }

    function mostrarSolicitacoes() {
      const area = document.getElementById("solicitacoes");
      const minhasSolicitacoes = solicitacoes.filter(
        (s) => s.fisioEmail === usuarioLogado.email
      );

      if (minhasSolicitacoes.length === 0) {
        area.innerHTML = "<p>Nenhuma solicitação recebida.</p>";
      } else {
        area.innerHTML = minhasSolicitacoes
          .map((s) => `<div class="solicitacao"><b>${s.pacienteNome}</b><br>Telefone: ${s.pacienteTelefone}</div>`)
          .join("");
      }
    }
  </script>
</body>
</html>
